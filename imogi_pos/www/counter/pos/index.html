{% extends "templates/web.html" %}

{% block base_scripts %}
{# Override to prevent Frappe from loading default scripts that cause 404 errors #}
{% endblock %}

{% block head_include %}
{# Override to prevent Frappe from preloading scripts that don't exist #}
{% endblock %}

{% block style %}
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;500;700&family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">

<link rel="stylesheet" href="/assets/imogi_pos/css/base.css">
<link rel="stylesheet" href="/assets/imogi_pos/css/components.css">
<link rel="stylesheet" href="/assets/imogi_pos/css/cashier_console.css">

<style>
  /* ===== Monochrome, Light-Only ===== */
  :root{
    color-scheme: light;            /* paksa light theme */
    --ink: #111;                    /* teks utama (hitam) */
    --ink-2: #3f3f46;               /* teks sekunder (abu tua) */
    --muted: #6b7280;               /* placeholder/label */
    --bg: #f5f6f7;                  /* latar halaman */
    --surface: #fff;                /* kartu/panel */
    --line: #e6e7eb;                /* garis/border */
    --line-soft: #ededf0;

    --radius: 12px;
    --radius-lg: 14px;
    --shadow-sm: 0 1px 2px rgba(0,0,0,.05);
    --shadow-md: 0 6px 18px rgba(0,0,0,.08);

    --gap: 18px;
    --sidebar-w: min(420px, 32vw);
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  html{font-size: clamp(14px, 0.35vw + 12px, 16px)}
  body{
    font-family: "Ubuntu", "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
    background: var(--bg);
    color: var(--ink);
    font-weight: 400;
    line-height: 1.5;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  /* ===== Header (bersih, tipis) ===== */
  .app-header{
    display:grid; grid-template-columns: 1fr auto 1fr; align-items:center;
    gap: 16px; padding: 14px 20px;
    background: var(--surface);
    border-bottom: 1px solid var(--line);
    box-shadow: var(--shadow-sm);
    position: sticky; top:0; z-index:10;
  }
  .page-title{margin:0;font-weight:700;font-size:18px}
  .header-left, .header-right{display:flex;align-items:center;gap:10px}
  .home-link{display:grid;place-items:center;width:36px;height:36px;border:1px solid var(--line);border-radius:10px;color:var(--ink)}
  .brand-logo{height:26px}
  
  /* Mode & Branch Indicators */
  .mode-indicator, .branch-selector, .user-menu{
    display:flex;align-items:center;gap:6px;font-size:13px;
  }
  .mode-label, .branch-label{color:var(--muted);font-weight:500}
  .mode-value, .branch-value, .user-name{
    padding:6px 12px;border-radius:6px;font-weight:600;
  }
  .badge{background:#f1f5f9;color:var(--ink-2);border:1px solid var(--line)}
  .badge-warning{background:#fef3c7;color:#92400e;border-color:#fde68a}
  .badge-success{background:#d1fae5;color:#065f46;border-color:#a7f3d0}
  .badge-info{background:#dbeafe;color:#1e40af;border-color:#bfdbfe}
  .badge-secondary{background:#e5e7eb;color:#4b5563;border-color:#d1d5db}
  
  /* Customer Display Status */
  .customer-display-status{display:flex;align-items:center;gap:6px;font-size:13px}
  .status-indicator i{font-size:8px;vertical-align:middle}
  #display-status-icon.online{color:#10b981}
  #display-status-icon.offline{color:#ef4444}
  #display-status-icon.checking{color:#f59e0b;animation:pulse 2s infinite}
  
  /* Responsive header */
  @media (max-width: 768px){
    .app-header{grid-template-columns:auto 1fr;gap:8px;padding:10px 14px}
    .header-left{order:2;justify-content:flex-end}
    .header-right{order:1;flex-wrap:wrap;gap:6px;font-size:12px}
    .mode-label, .branch-label{display:none}
    .page-title{font-size:16px}
  }

  /* ===== Layout ===== */
  .cashier-console{
    display:grid; gap: 22px;
    grid-template-columns: minmax(0,1fr) var(--sidebar-w);
    padding: 20px; max-width: 1360px; margin-inline:auto;
  }
  @media (max-width: 1100px){ .cashier-console{ grid-template-columns: 1fr } }
  .cashier-console.disabled{ filter:saturate(.75); pointer-events:none; user-select:none }

  /* ===== Card ===== */
  .card{
    background: var(--surface);
    border: 1px solid var(--line);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-md);
  }
  .card-body{padding:16px}
  .section-title{
    margin:0;
    padding:0;
    font-weight:700;
    font-size:18px;
    line-height:1.3;
    color: var(--ink);
  }

  /* ===== Order List ===== */
  .order-header{
    display:flex;justify-content:space-between;align-items:center;
    padding: 16px 18px; 
    border-bottom:1px solid var(--line);
    background: #fff;
  }
  .order-actions{
    display:flex;
    gap:8px;
    align-items:center;
  }

  .order-tabs{display:flex;gap:8px; padding:10px 18px 0; flex-wrap:wrap}
  .order-tab{
    padding:8px 12px;
    border:1px solid var(--line);
    border-radius: 999px;
    background: #fff;
    color: var(--ink-2);
    font-weight:600; font-size:13px; cursor:pointer;
    transition: background .15s ease, border-color .15s ease, color .15s ease, box-shadow .15s ease;
  }
  .order-tab:hover{ background:#f2f3f5; border-color:#dcdfe4; color:var(--ink) }
  .order-tab.active{
    background:#1f1f1f; color:#fff; border-color:#1f1f1f;
    box-shadow: 0 1px 0 rgba(0,0,0,.04);
  }

  .search-container{ padding: 12px 18px 8px }
  .search-input{
    width:100%; padding:11px 12px;
    border:1px solid var(--line); border-radius: 10px;
    background: #fff;
    color: var(--ink);                /* teks input hitam */
    outline: none;
  }
  .search-input::placeholder{ color: var(--muted) }
  .search-input:focus{ border-color:#cfd3d9; box-shadow: 0 0 0 3px rgba(0,0,0,.06) }

  .order-list{ 
    padding: 8px 18px 18px; 
    min-height:400px; 
    max-height:calc(100vh - 300px);
    overflow-y:auto;
    overflow-x:hidden;
  }
  .order-card{
    border:1px solid var(--line); border-radius:12px; background:#fff;
    padding:12px; margin-top:12px;
    transition: transform .1s ease, box-shadow .15s ease, border-color .15s ease, background .15s ease;
  }
  .order-card:hover{ transform: translateY(-1px); box-shadow: var(--shadow-md); border-color:#dfe2e6 }
  .order-card.selected{ background:#fafafa; border-color:#cfd3d9 }
  .order-meta{display:flex;justify-content:space-between;gap:10px;color:var(--muted);font-size:12px;margin-bottom:6px}
  .order-info{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:12px;
    margin-bottom:6px;
  }
  .order-amount{
    font-weight:700;
    font-size:15px;
    white-space:nowrap;
    color:var(--ink);
  }
  .order-items{margin-top:8px;display:flex;flex-direction:column;gap:6px;font-size:13px;color:var(--ink)}
  .order-item{display:flex;align-items:center;gap:8px}
  .order-item-img img{width:32px;height:32px;object-fit:cover;border-radius:6px}
  .order-item-name{flex:1}
  .order-item-meta{font-size:12px;color:var(--muted)}

  .badge{
    display:inline-flex;align-items:center;gap:6px;
    padding:4px 10px;border-radius:999px;font-size:12px;
    background:#fff;border:1px solid var(--line);color:var(--ink-2)
  }

  .empty-state{
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    text-align:center;
    gap:8px;
    color:var(--muted); 
    padding:32px 22px; 
    border:1px dashed var(--line); 
    border-radius:12px; 
    background:#fff;
    min-height:200px;
  }
  .empty-state strong{
    color:var(--ink-2);
    font-size:15px;
  }

  /* ===== Checkout ===== */
  .checkout-panel{ display:flex; flex-direction:column; min-height:560px }
  .checkout-panel-header{ padding:16px 18px; border-bottom:1px solid var(--line); font-weight:700 }

  .customer-info{
    margin:16px 18px 12px; padding:12px;
    border:1px solid var(--line); border-radius:12px; background:#fff;
  }
  .customer-info-header{ display:flex; justify-content:space-between; align-items:center; gap:10px; margin-bottom:6px }
  .customer-search-btn{ color:#111; font-weight:700; border:1px solid var(--line); background:#fff; padding:6px 10px; border-radius:8px; cursor:pointer }
  .customer-search-btn:hover{ background:#f2f3f5 }

  .checkout-items{ flex:1; margin:0 18px 14px; overflow:auto }
  .checkout-item{ display:flex; justify-content:space-between; gap:12px; padding:12px 0; border-bottom:1px dashed var(--line); font-size:14px }
  .item-image{width:40px;height:40px}
  .item-image img{width:100%;height:100%;object-fit:cover;border-radius:6px}
  .item-details{flex:1}
  .item-name{font-weight:500}
  .item-notes{font-size:12px;color:var(--muted)}
  .item-quantity-price{display:flex;flex-direction:column;align-items:flex-end;min-width:70px}

  .checkout-totals{ margin:0 18px 16px; padding-top:12px; border-top:1px solid var(--line) }
  .total-row{ display:flex; justify-content:space-between; margin:6px 0; color:var(--ink) }
  .grand-total{ font-size:18px; font-weight:800 }

  /* ===== Buttons (monochrome) ===== */
  .btn{
    display:inline-flex;align-items:center;justify-content:center;gap:8px;
    min-height:40px; padding:10px 14px;
    border-radius:10px; border:1px solid var(--line);
    background:#fff; color:var(--ink); 
    font-weight:600; font-size:14px;
    cursor:pointer;
    transition: background .15s ease, border-color .15s ease, transform .05s ease;
  }
  .btn:hover{ background:#f2f3f5; border-color:#dcdfe4 }
  .btn:active{ transform: translateY(1px) }
  .btn-primary{ background:#111; color:#fff; border-color:#111; font-weight:700 }
  .btn-primary:hover{ background:#000 }

  .btn-accent{ background:#2b2b2b; color:#fff; border-color:#2b2b2b }
  .btn-accent:hover{ background:#1f1f1f }
  .btn-ghost{ background:#f7f7f7; border-color:var(--line); color:#111 }

  .checkout-actions{ display:flex; flex-direction:column; gap:10px; margin:0 18px 18px }

  .session-warning, .error-message{
    margin:16px auto; max-width:1080px; border-radius:12px; padding:12px 14px; border:1px solid var(--line);
  }
  .session-warning{ background:#fffdf5; color:#6b5a00 }
  .error-message{ background:#fff5f5; color:#8a1b1b }

  /* Scrollbar halus (Chromium) */
  .order-list::-webkit-scrollbar,
  .checkout-items::-webkit-scrollbar{ height:10px; width:10px }
  .order-list::-webkit-scrollbar-thumb,
  .checkout-items::-webkit-scrollbar-thumb{ background:#d6d7db; border-radius:999px }

  /* ===== Item Selector Modal ===== */
  .item-selector-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .modal-backdrop {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
  }
  .modal-dialog {
    position: relative;
    width: 95%;
    max-width: 1400px;
    height: 90vh;
    background: var(--surface);
    border-radius: var(--radius-lg);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    display: flex;
    flex-direction: column;
  }
  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 18px 24px;
    border-bottom: 1px solid var(--line);
  }
  .modal-header h3 {
    margin: 0;
    font-size: 20px;
    font-weight: 700;
  }
  .modal-close {
    width: 36px;
    height: 36px;
    border: none;
    background: #f5f6f7;
    border-radius: 8px;
    font-size: 24px;
    cursor: pointer;
    color: var(--ink);
    transition: background 0.15s ease;
  }
  .modal-close:hover {
    background: #e5e7eb;
  }
  .modal-toolbar {
    display: flex;
    gap: 12px;
    padding: 12px 24px;
    border-bottom: 1px solid var(--line);
    background: #fafbfc;
  }
  .modal-toolbar .search-input {
    flex: 1;
    max-width: 400px;
  }
  .modal-toolbar #category-filter {
    min-width: 180px;
  }
  .order-type-selector {
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .order-type-selector label {
    display: flex;
    align-items: center;
    gap: 6px;
    margin: 0;
    font-size: 13px;
    cursor: pointer;
  }
  .modal-body {
    flex: 1;
    display: grid;
    grid-template-columns: 1fr 380px;
    gap: 16px;
    padding: 16px 24px;
    overflow: hidden;
  }
  
  /* Item Grid */
  .item-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 12px;
    height: 100%;
    overflow-y: auto;
    padding-right: 8px;
  }
  .item-card {
    border: 1px solid var(--line);
    border-radius: 12px;
    padding: 12px;
    background: #fff;
    cursor: pointer;
    transition: transform 0.1s ease, box-shadow 0.15s ease, border-color 0.15s ease;
  }
  .item-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
    border-color: #cfd3d9;
  }
  .item-card-image {
    width: 100%;
    aspect-ratio: 1;
    object-fit: cover;
    border-radius: 8px;
    margin-bottom: 8px;
    background: #f5f6f7;
  }
  .item-card-name {
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 4px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .item-card-price {
    font-size: 13px;
    color: var(--ink-2);
    font-weight: 700;
  }
  .item-card-stock {
    font-size: 11px;
    color: var(--muted);
    margin-top: 4px;
  }
  .item-card.out-of-stock {
    opacity: 0.5;
    cursor: not-allowed;
  }
  
  /* Cart Panel */
  .cart-panel {
    border-left: 1px solid var(--line);
    padding-left: 16px;
    display: flex;
    flex-direction: column;
  }
  .cart-panel h4 {
    margin: 0 0 12px 0;
    font-size: 16px;
    font-weight: 700;
  }
  .cart-items {
    flex: 1;
    overflow-y: auto;
    margin-bottom: 12px;
  }
  .cart-item {
    display: flex;
    gap: 10px;
    padding: 10px 0;
    border-bottom: 1px dashed var(--line);
  }
  .cart-item-details {
    flex: 1;
    min-width: 0;
  }
  .cart-item-name {
    font-weight: 600;
    font-size: 13px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .cart-item-price {
    font-size: 12px;
    color: var(--muted);
  }
  .cart-item-qty {
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .qty-btn {
    width: 28px;
    height: 28px;
    border: 1px solid var(--line);
    border-radius: 6px;
    background: #fff;
    cursor: pointer;
    font-size: 16px;
    transition: background 0.15s ease;
  }
  .qty-btn:hover {
    background: #f5f6f7;
  }
  .qty-value {
    min-width: 32px;
    text-align: center;
    font-weight: 700;
  }
  .cart-item-remove {
    color: #ef4444;
    cursor: pointer;
    font-size: 18px;
    padding: 4px;
  }
  .empty-cart {
    text-align: center;
    color: var(--muted);
    padding: 24px;
  }
  .cart-totals {
    border-top: 1px solid var(--line);
    padding-top: 12px;
    margin-bottom: 12px;
  }
  .btn-block {
    width: 100%;
  }
  .loading-items {
    grid-column: 1 / -1;
    text-align: center;
    padding: 48px;
    color: var(--muted);
  }

</style>
{% endblock %}

{% block page_content %}
{% if setup_error %}
{% include "imogi_pos/templates/includes/error_page.html" %}
{% else %}

{% if show_header %}
<header class="app-header">
  <div class="header-left">
    <a href="/" class="home-link" aria-label="Home">
      <i class="fa fa-home" aria-hidden="true"></i>
    </a>
    <h1 class="page-title">{{ _("Cashier Console") }}</h1>
  </div>

  <div class="header-center" aria-label="Brand">
    {% if branding.logo %}
      {% if branding.logo_dark %}
      <picture>
        <source srcset="{{ branding.logo_dark }}" media="(prefers-color-scheme: dark)">
        <img src="{{ branding.logo }}" alt="{{ branding.name|default('IMOGI POS') }}" class="brand-logo">
      </picture>
      {% else %}
      <img src="{{ branding.logo }}" alt="{{ branding.name|default('IMOGI POS') }}" class="brand-logo">
      {% endif %}
    {% else %}
      <span class="brand-name">{{ branding.name|default("IMOGI POS") }}</span>
    {% endif %}
  </div>

  <div class="header-right">
    {% if domain or mode %}
    <div class="mode-indicator" role="status" aria-live="polite">
      <span class="mode-label">{{ _("Mode") }}:</span>
      <span class="mode-value badge badge-{{ 'warning' if domain == 'Restaurant' else ('success' if domain == 'Retail' else 'info') }}">
        {{ domain or "Restaurant" }} - {{ mode or "Counter" }}
      </span>
    </div>
    {% endif %}
    <div class="customer-display-status" role="status" style="display:none;" title="Customer Display Status">
      <span class="status-label">{{ _("Display") }}:</span>
      <span class="status-indicator badge badge-secondary" id="display-status-badge">
        <i class="fa fa-circle" id="display-status-icon"></i> {{ _("Checking") }}
      </span>
    </div>
    {% if branch %}
    <div class="branch-selector" role="status" aria-live="polite">
      <span class="branch-label">{{ _("Branch") }}:</span>
      <span class="branch-value badge">{{ branch_label or branch }}</span>
    </div>
    {% endif %}
    <div class="user-menu">
      <span class="user-name badge"><i class="fa fa-user" aria-hidden="true"></i>&nbsp;{{ frappe.session.user }}</span>
    </div>
  </div>
</header>
{% endif %}

{% if error_message %}
  <div class="error-message card"><div class="card-body">
    {{ error_message }}
  </div></div>
{% elif require_pos_session and enforce_session_on_cashier and not has_active_session %}
  <div class="session-warning card">
    <div class="card-body" style="display:flex;justify-content:space-between;align-items:center;gap:12px;">
      <span>{{ _("No active POS Session. Please open a session to continue.") }}</span>
      <a href="/desk#pos-session/new-pos-session-1" class="btn btn-primary">{{ _("Open Session") }}</a>
    </div>
  </div>
{% endif %}

{% if not error_message %}
<div class="cashier-console {% if require_pos_session and enforce_session_on_cashier and not has_active_session %}disabled{% endif %}">
  <!-- Order list -->
  <section class="order-list-container card" aria-labelledby="orders-heading">
    <div class="order-header">
      <h2 id="orders-heading" class="section-title" style="border:none; padding:0; margin:0">{{ _("Orders") }}</h2>
      <div class="order-actions">
        <button id="create-order" class="btn btn-primary" type="button">
          <i class="fa fa-plus" aria-hidden="true"></i>&nbsp;{{ _("Create Order") }}
        </button>
        <button id="refresh-orders" class="btn btn-default" type="button">
          <i class="fa fa-rotate" aria-hidden="true"></i>&nbsp;{{ _("Refresh") }}
        </button>
      </div>
    </div>

    <div class="order-tabs" role="tablist" aria-label="{{ _('Order filters') }}" style="display:none;">
      <div class="order-tab" role="tab" aria-selected="false" tabindex="0" data-status="Draft">{{ _("Draft") }}</div>
      <div class="order-tab" role="tab" aria-selected="false" tabindex="0" data-status="Pending">{{ _("Pending") }}</div>
      <div class="order-tab" role="tab" aria-selected="false" tabindex="0" data-status="Ready">{{ _("Ready") }}</div>
      <div class="order-tab" role="tab" aria-selected="false" tabindex="0" data-status="Confirmed">{{ _("Confirmed") }}</div>
      <div class="order-tab active" role="tab" aria-selected="true" tabindex="0" data-status="All">{{ _("All") }}</div>
    </div>

    <div class="search-container">
      <label class="sr-only" for="order-search">{{ _('Search Orders') }}</label>
      <input id="order-search" type="text" class="search-input" placeholder="{{ _('Search by order number, queue, or customer...') }}" aria-label="{{ _('Search Orders') }}">
    </div>

    <div id="order-list" class="order-list">
      <div class="empty-state" aria-live="polite">
        <div>
          <strong>{{ _("Loading orders…") }}</strong>
          <div style="font-size:12px;margin-top:4px">{{ _("Please wait") }}</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Item Selector Modal (for creating new orders) -->
  <div id="item-selector-modal" class="item-selector-modal" style="display:none;">
    <div class="modal-backdrop"></div>
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h3>{{ _("Create New Order - Select Items") }}</h3>
          <button class="modal-close" id="close-item-selector" aria-label="{{ _('Close') }}">×</button>
        </div>
        
        <div class="modal-toolbar">
          <input type="text" id="item-search" class="search-input" placeholder="{{ _('Search items...') }}">
          <select id="category-filter" class="btn">
            <option value="">{{ _("All Categories") }}</option>
          </select>
          <div class="order-type-selector">
            <label style="font-size:13px;margin-right:8px;">{{ _("Type") }}:</label>
            <label><input type="radio" name="order-type" value="Takeaway" checked> {{ _("Takeaway") }}</label>
            <label><input type="radio" name="order-type" value="Dine-in"> {{ _("Dine-in") }}</label>
          </div>
        </div>
        
        <div class="modal-body">
          <div class="item-grid" id="item-grid">
            <div class="loading-items">{{ _("Loading items...") }}</div>
          </div>
          
          <div class="cart-panel">
            <h4>{{ _("Current Order") }}</h4>
            <div id="cart-items" class="cart-items">
              <div class="empty-cart">{{ _("No items added yet") }}</div>
            </div>
            <div class="cart-totals">
              <div class="total-row"><span>{{ _("Subtotal") }}</span><span id="cart-subtotal">0.00</span></div>
              <div class="grand-total total-row"><span>{{ _("Total") }}</span><span id="cart-total">0.00</span></div>
            </div>
            <button id="submit-order" class="btn btn-primary btn-block" disabled>
              {{ _("Submit Order") }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Checkout -->
  <aside class="checkout-panel card" aria-labelledby="checkout-heading">
    <div class="checkout-panel-header" id="checkout-heading">{{ _("Checkout") }}</div>

    <div class="customer-info" aria-labelledby="customer-heading">
      <div class="customer-info-header">
        <span id="customer-heading">{{ _("Customer") }}:
          <span id="customer-name" class="badge">{{ _("Walk-in Customer") }}</span>
        </span>
        <button class="customer-search-btn" id="find-customer" type="button" aria-describedby="customer-heading">{{ _("Find / Create") }}</button>
      </div>
      <div id="customer-details" class="customer-details" style="font-size:13px; color:var(--muted)"></div>
    </div>

    <div id="checkout-items" class="checkout-items">
      <div class="empty-state">
        <div>
          <strong>{{ _("Select an order to checkout") }}</strong>
          <div style="font-size:12px;margin-top:4px">{{ _("Choose an item on the left to see details here.") }}</div>
        </div>
      </div>
    </div>

    <div class="checkout-totals">
      <div class="total-row"><span>{{ _("Subtotal") }}</span><span id="subtotal">0.00</span></div>
      <div class="total-row"><span>{{ _("PB1") }}</span><span id="tax-amount">0.00</span></div>
      <div class="total-row"><span>{{ _("Discount") }}</span><span id="discount-amount">0.00</span></div>
      <div class="grand-total total-row"><span>{{ _("Total") }}</span><span id="grand-total">0.00</span></div>
    </div>

    <div class="checkout-actions">
      <select id="payment-mode" class="btn" style="margin-right:8px">
        <option value="">{{ _("Mode of Payment") }}</option>
        <option value="Cash">{{ _("Cash") }}</option>
        <option value="Card">{{ _("Card") }}</option>
        <option value="Online">{{ _("Online") }}</option>
      </select>
      <button id="btn-generate-invoice" class="btn btn-primary" type="button" disabled>{{ _("Generate Invoice") }}</button>
      <button id="btn-request-payment" class="btn btn-accent" type="button" disabled>{{ _("Request Payment") }}</button>
      <button id="btn-print-bill" class="btn btn-ghost" type="button" disabled>{{ _("Print Bill") }}</button>
    </div>
  </aside>
</div>

{% endif %}  {# Close 'if not error_message' #}
{% endif %}  {# Close 'if setup_error' from block page_content #}
{% endblock %}

{% block script %}
{% if not setup_error %}
<script>
  // Pass context to JS
  window.FRAPPE_CSRF_TOKEN = '{{ frappe.session.csrf_token }}';
  window.POS_PROFILE        = {{ (pos_profile.name if pos_profile else none) | tojson }};
  window.ACTIVE_POS_SESSION = {{ (active_pos_session.name if active_pos_session else none) | tojson }};
  window.CURRENT_BRANCH     = {{ (branch if branch else none) | tojson }};
  window.CURRENT_BRANCH_LABEL = {{ (branch_label if branch_label else (branch if branch else none)) | tojson }};
  window.CURRENCY_SYMBOL    = {{ (currency_symbol if currency_symbol else "Rp") | tojson }};
  window.DOMAIN             = {{ (domain if domain else "Restaurant") | tojson }};
  window.MODE               = {{ (mode if mode else "Counter") | tojson }};

  // Minor UX: toggle active class on tabs with keyboard support
  document.addEventListener('DOMContentLoaded', () => {
    const tabs = Array.from(document.querySelectorAll('.order-tab'));
    const list = document.getElementById('order-list');

    tabs.forEach(tab => {
      tab.addEventListener('click', () => setActive(tab));
      tab.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); setActive(tab); }
      });
    });

    function setActive(el){
      tabs.forEach(t => t.classList.remove('active'));
      el.classList.add('active');
      el.setAttribute('aria-selected', 'true');
      tabs.filter(t=>t!==el).forEach(t=>t.setAttribute('aria-selected','false'));

      if (!list) return;
      const status = el.dataset.status;
      list.querySelectorAll('[data-status]').forEach(item => {
        item.hidden = !(status === 'All' || item.dataset.status === status);
      });
    }

    const initial = tabs.find(t => t.classList.contains('active'));
    if (initial) setActive(initial);

    // Header shadow on scroll
    const header = document.querySelector('.app-header');
    if (header) {
      const onScroll = () => header.style.boxShadow = window.scrollY > 6 ? 'var(--shadow-md)' : 'var(--shadow-sm)';
      document.addEventListener('scroll', onScroll, { passive: true });
      onScroll();
    }
  });
</script>
<style>
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }
</style>
<script type="module" src="/assets/frappe/js/frappe-web.bundle.js"></script>
<script type="module" src="/assets/frappe/js/dialog.bundle.js"></script>
<script src="/assets/imogi_pos/js/core/nav.js"></script>
<script src="/assets/imogi_pos/js/core/auth.js"></script>
<script src="/assets/imogi_pos/js/core/branch.js"></script>
<script src="/assets/imogi_pos/js/print/service.js"></script>
<script src="/assets/imogi_pos/js/print/adapter_bluetooth.js"></script>
<script src="/assets/imogi_pos/js/print/adapter_bridge.js"></script>
<script src="/assets/imogi_pos/js/print/adapter_lan.js"></script>
<script src="/assets/imogi_pos/js/print/adapter_spool.js"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

<script src="/counter/pos/index.js"></script>
{% endif %}
{% endblock %}
